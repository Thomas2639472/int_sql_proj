# Intermediate SQL - Sales Analysis - [Luke Barousse Course](https://www.youtube.com/watch?v=QKIGsShyEsQ)

## Overview
My version of the Luke Barousse Intermediate SQL Data Analytics Course. Highly similar to his of course, with a few extra additions and plots.

## Business Questions
1. <b>Customer Segmentation</b>
2. <b>Cohort Analysis</b>
3. <b>Customer Retention</b>

## Analysis Approach

### <u>1. Customer Segmentation</u>
- Customers were grouped into cohorts based on their LTV.  
- Each cohort’s contribution to total orders and lifetime revenue was quantified and visualized.  
- This revealed how different segments drive business performance and highlighted opportunities to refine marketing strategies toward low-value but high-potential customers.  

<b>💻 Queries: 
- [1_customer_segmentation-ltv_segments_as_pct_of_lifetime_rev.sql](/Scripts/1_customer_segmentation-ltv_segments_as_pct_of_lifetime_rev.sql)
- [1_customer_segmentation-ltv_segments_as_pct_of_lifetime_orders.sql](/Scripts/1_customer_segmentation-ltv_segments_as_pct_of_lifetime_orders.sql)</b>

**📈 Visualisations:**

<img src="/images/1_customer_segmentation-ltv_segments_as_pct_of_lifetime_rev.png" alt="Customer Segmentation - Lifetime Revenue" style="width:65%;">

<img src="/images/1_customer_segmentation-ltv_segments_as_pct_of_lifetime_orders.png" alt="Customer Segmentation - Lifetime Orders" style="width:65%;">


**📊 Key Findings:**
- The top quartile of highest LTV customers contribute almost two thirds of company lifetime revenue!
- The top quartile of highest LTV customers contribute around half of total orders.
- Clearly high LTV customers make more orders and more expensive orders on average ---- {add something about this that leads to business insights...}

**💡 Business Insights:**
- High LTV customers are driving a disproportionate share of revenue → retention and upsell strategies for this group could yield outsized returns.
- The long tail of low-value customers contributes very little individually but may represent a large pool of untapped potential.
- Marketing spend may currently be too evenly distributed — reallocating resources toward nurturing “high-potential but low-current-value” cohorts could improve ROI.

---

### <u>2. Cohort Analysis</u>
- First-year revenue and order counts were calculated and plotted for each cohort.  
- This exposed trends in customer value and uncovered shifts in revenue contribution across acquisition years.  

<b>💻 Queries: 
- [2_cohort_analysis-year_rev_by_cohort.sql](/Scripts/2_cohort_analysis-year_rev_by_cohort.sql)
- [2_cohort_analysis-day_rev_by_cohort.sql](/Scripts/2_cohort_analysis-day_rev_by_cohort.sql)
- [2_cohort_analysis-year_orders_by_cohort.sql](/Scripts/2_cohort_analysis-year_orders_by_cohort.sql)</b>

**📈 Visualisations:**

<img src="/images/2_cohort_analysis-year_rev_by_cohort.png" alt="Cohort Analysis 1st Year Revenue by Cohort" style="width:65%;">
<table>
  <tr>
    <td>
      <img src="/images/2_cohort_analysis-day_rev_by_cohort.png" alt="Cohort Analysis 1st Day Revenue by Cohort" style="width:100%;">
    </td>
    <td style="vertical-align: top; padding-left: 15px;">
      <i>This is extremely similar to the 1st year revenue as most customers' revenue for the year is generated by their first order. 
      This, however, allows us to extrapolate to 2024 while still enabling us to compare total orders and total revenue 
      for the first year by cohort.</i>
    </td>
  </tr>
</table>

<img src="/images/2_cohort_analysis-year_orders_by_cohort.png" alt="Cohort Analysis 1st Year Total Orders by Cohort" style="width:65%;">

**📊 Key Findings:**
- First-year and first-day customer revenue shows a downward trend in more recent cohorts, indicating declining spend per customer.
- First-year order volume has trended slightly upward among younger cohorts, suggesting increased activity but at lower revenue per order.
- Together, these trends point to a potential erosion of overall customer value in newer cohorts.

**💡 Business Insights:**
- Declining first-year revenue per customer in recent cohorts signals falling acquisition quality — newer customers may be less committed or responding to different acquisition channels.
- Slightly higher first-year order counts suggest that frequency is up, but average order value (AOV) is declining. This could indicate growing price sensitivity or changes in product mix.
- Without intervention, future cohorts may continue the trend of more orders but lower spend, reducing lifetime value.

---

### <u>3. Customer Retention</u>
- Customers were segmented by acquisition year and classified as **Active** or **Churned**, based on purchasing activity within the last six months.  
- The percentage of churned versus active customers was then plotted by cohort.  
- This surfaced critical retention challenges and pinpointed weaknesses in sustaining long-term customer value.  


<b>💻 Queries: 
- [3_retention_analysis-pct_active](/Scripts/3_retention_analysis-pct_active.sql)
- [3_retention_analysis-avg_orders](/Scripts/3_retention_analysis-pct_active.sql)</b>

**📈 Visualisation:**

<img src="/images/3_customer_retention_bar.png" alt="Retention Analysis Bar Chart" style="width:65%;">
<img src="/images/3_customer_retention_line.png" alt="Retention Analysis Line Chart" style="width:65%;">
<img src="/images/3_customer_retention_orders_per_year.png" alt="Retention Analysis Orders per Year" style="width:65%;">

**📊 Key Findings:**
- Churn remains consistently high (~90%) across all cohorts.
- Active customers, though a small minority, now place ~5 orders/year on average (up from ~2.6 in 2015).
- The customer base is becoming polarized: most churn early, but retained customers are increasingly valuable.

**💡 Business Insights:**
- While churn is a persistent challenge, the customers who remain active are significantly more engaged and generate rising order volumes.
- Even a small shift in retaining more customers into this high-frequency group could yield outsized revenue gains.
- Early retention efforts (e.g., onboarding, loyalty incentives, personalized offers) are key to capturing this value.

## Strategic Recommendations
1. Prioritize retention over acquisition: A small improvement in churn (e.g. from 9% active → 15% active) could drive significant long-term revenue.

2. Double down on high LTV customers: Introduce VIP programs, personalized offers, or early access to maximize loyalty and referrals.

3. Revisit acquisition strategy: Investigate why newer cohorts spend less — is it due to discount-heavy channels, different customer demographics, or weaker onboarding?

4. Lift AOV through cross-sell/upsell: Since order frequency is rising, bundle offers, tiered discounts, or loyalty points could raise per-order value.

5. Monitor cohort quality: Track acquisition channel by cohort to pinpoint which sources bring in high-value vs. low-value customers.

## Technical Details
- **Database:** PostgreSQL
- **Analysis Tools:** DBeaver, PostrgeSQL, PGAdmin
- **Visualisations:** ChatGPT, Python (Matplotlib)

